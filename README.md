# habits-control

### Техническое задание: «HabitFlow»

**1. Описание проекта**

HabitFlow — это веб-приложение для отслеживания ежедневных привычек. Пользователь может зарегистрироваться, создать список привычек (например, "читать 30 минут", "пить воду", "заниматься спортом") и каждый день отмечать их выполнение. Приложение показывает статистику и прогресс по каждой привычке.

**2. Цель**

Создать полнофункциональное веб-приложение с чистым REST API на Go, простым фронтендом на шаблонах, аутентификацией, работой с базой данных и деплоем в Docker.

**3. Стек технологий**

*   **Бэкенд:** Go (Gin или Echo framework - рекомендуются для новичков)
*   **Фронтенд:** HTML-шаблоны (`html/template`), немного CSS (можно использовать Bootstrap для простоты) и минимальный Vanilla JavaScript для AJAX-запросов.
*   **База данных:** **PostgreSQL** (как часто используемая в продакшене, вместо SQLite).
*   **Аутентификация:** JWT (JSON Web Tokens) для защиты API-эндпоинтов + сессии (через куки) для работы с шаблонами. *Это даст вам опыт работы с двумя подходами.*
*   **Контейнеризация:** Docker и Docker Compose.
*   **Дополнительные технологии (то, что вы не упомянули, но часто используется):**
    *   **Миграции базы данных:** `golang-migrate` для версионирования схемы БД.
    *   **Драйвер БД:** `pgx` или `lib/pq` для работы с PostgreSQL.
    *   **Конфигурация:** Чтение конфигов из environment variables (через `os.Getenv` или библиотеку `godotenv` для разработки).
    *   **Логирование:** Стандартный `log` или более продвинутый `slog` (от Go 1.21).
    *   **Валидация:** Структур на бэкенде (например, `go-playground/validator` для Gin).

**4. Функциональные требования**

**4.1. Аутентификация и Авторизация**
*   `[ ]` **Регистрация:** Эндпоинт `POST /api/register`. Принимает email и пароль. Хэширует пароль (bcrypt) и сохраняет пользователя в БД.
*   `[ ]` **Вход:** Эндпоинт `POST /api/login`. Проверяет учетные данные, возвращает JWT-токен *и устанавливает сессионную куку* для доступа к HTML-страницам.
*   `[ ]` **Промежуточное ПО (Middleware):** Создать middleware для проверки JWT-токена (для API) и отдельно — для проверки сессии (для рендеринга шаблонов).
*   `[ ]` **Выход:** Эндпоинт `POST /api/logout`, который очищает сессию на бэкенде.

**4.2. Управление привычками (REST API)**
*   `[ ]` `GET /api/habits` — получить список всех привычек текущего пользователя.
*   `[ ]` `POST /api/habits` — создать новую привычку (название, описание).
*   `[ ]` `PUT /api/habits/{id}` — обновить привычку.
*   `[ ]` `DELETE /api/habits/{id}` — удалить привычку.

**4.3. Отслеживание прогресса (REST API)**
*   `[ ]` `POST /api/habits/{id}/complete` — отметить привычку как выполненную на сегодня. Создает или обновляет запись в таблице `habit_logs`.
*   `[ ]** `GET /api/stats` — получить статистику для дашборда (например, количество выполненных привычек за последние 7 дней).

**4.4. Фронтенд (HTML-шаблоны)**
*   `[ ]` **Страница входа/регистрации.**
*   `[ ]` **Главная страница (Дашборд):**
    *   Список привычек пользователя.
    *   Возле каждой привычки — кнопка "Выполнено" (отправляет AJAX-запрос на `POST /api/habits/{id}/complete`).
    *   Простая визуализация прогресса (например, "за последнюю неделю выполнено 5 из 7 дней").
*   `[ ]** `Страница создания/редактирования привычки.

**5. Структура базы данных (примерная)**

```sql
-- Таблица пользователей
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Таблица привычек
CREATE TABLE habits (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Таблица для логов выполнения привычек
CREATE TABLE habit_logs (
    id SERIAL PRIMARY KEY,
    habit_id INTEGER REFERENCES habits(id) ON DELETE CASCADE,
    completed_date DATE NOT NULL, -- Дата, за которую отметили выполнение
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(habit_id, completed_date) -- Чтобы нельзя было отметить дважды за день
);
```

**6. Деплой с помощью Docker**

*   `[ ]` Написать `Dockerfile` для мульти-стадийной сборки Go-приложения.
*   `[ ]** `Написать `docker-compose.yml`, который включает в себя:
    *   Сервис для вашего Go-приложения.
    *   Сервис для PostgreSQL.
    *   Настроить сеть между ними.
    *   Использовать `.env` файл для конфигурации (пароли от БД, JWT-секрет).
*   `[ ]** `Запустить проект командой `docker-compose up`.

---

### План реализации (по шагам)

1.  **Настройка окружения:** Установите Go, Docker, Docker Compose. Создайте структуру проекта.
2.  **Docker:** Начните с `docker-compose.yml`, поднимите PostgreSQL. Напишите `Dockerfile` для приложения, чтобы оно могло запускаться в контейнере.
3.  **Конфигурация и БД:** Настройте подключение к БД из Go-кода, используя переменные окружения. Напишите миграции (`golang-migrate`) для создания таблиц.
4.  **Базовый веб-сервер:** Подключите Gin/Echo, настройте маршруты.
5.  **Модели и репозитории:** Опишите структуры `User`, `Habit`, `HabitLog` в Go. Напишите функции для взаимодействия с БД (CRUD).
6.  **Аутентификация:** Реализуйте регистрацию и вход. Сгенерируйте JWT. Создайте middleware для его проверки.
7.  **REST API:** Реализуйте все эндпоинты для привычек и логирования. Протестируйте их через Postman/curl.
8.  **Фронтенд (Шаблоны):** Создайте HTML-шаблоны. Настройте рендеринг. Реализуйте взаимодействие с бэкендом (формы для входа, AJAX для отметки привычек).
9.  **Интеграция и финальный деплой:** Соберите всё вместе, убедитесь, что `docker-compose up` запускает полностью рабочее приложение.

Этот проект станет отличным пунктом в вашем портфолио и даст глубокое понимание полного цикла веб-разработки. Удачи
